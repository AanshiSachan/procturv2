<loaders-css [loader]="'ball-scale-ripple-multiple'" class="app-loader-wrapper" [loaderClass]="'blueRipple'" *ngIf="isRippleLoad">
</loaders-css>

<div class="report-wrapper clearFix">
  <aside class="middle-full">
    <section class="middle-main clearFix">
      <div class="middle-top mb0 clearFix header">


        <div class="report-header" style="padding-bottom:1%">
          <h2 style="padding: 5px;" class="pull-left">
            <a routerLink="/view/reports">
              Report
            </a>
            <i style="font-family: 'FontAwesome';" class="fas fa-angle-right"></i>
            <a routerLink="/view/reports/fee">
              Fee Report
            </a>
            <i style="font-family: 'FontAwesome';" class="fas fa-angle-right"></i> Payment History
          </h2>
          <a (click)="searchByName()" class="showFilter" style="float:right;" *ngIf="searchByDateVisible">Show Name Filter</a>
          <a (click)="searchByDate()" class="showFilter" *ngIf="searchByNameVisible" style="float: right;">Hide Name Filter</a>
          <div class="row" *ngIf="searchByDateVisible">

            <div class="c-lg-12 field-made">
              <div class="c-lg-3 field-wrapper datePickerBox">
                <label for="from">From Date</label>
                <input type="text" class="form-ctrl" id="from" bsDatepicker [(ngModel)]="sendPayload.from_date" (ngModelChange)="futureDateValid($event)">
              </div>
              <div class="c-lg-3 field-wrapper datePickerBox">
                <label for="to">To Date</label>
                <input type="text" class="form-ctrl" id="to" bsDatepicker [(ngModel)]="sendPayload.to_date" (ngModelChange)="futureDateValid($event)">
              </div>
              <div class="c-lg-2" style="margin-top:2%;">
                <input type="button" class="btn fullBlue" value="GO" (click)="getAllPaymentHistory()">
              </div>


              <div style="padding-top: 20px" class="c-lg-12 lower">

                <div class="c-lg-10 field-correspond">

                  <div class="c-lg-4 field-radio-wrapper makeAdjust hide" style="text-align: left;">
                    <input type="radio" class="form-radio" name="active" [(ngModel)]="sendPayload.payment_history_student_category_option" [value]="0"
                      checked="true" id="active">
                    <label for="active">Active</label>
                  </div>
                  <!-- <div class="c-lg-4 field-radio-wrapper makeAdjust" style="text-align: left;">
                      <input type="radio" class="form-radio" name="active" [(ngModel)]="sendPayload.payment_history_student_category_option" [value]="2"
                        id="allStudents">
                      <label for="allStudents">All Students</label>
                    </div>
                    <div class="c-lg-4 field-radio-wrapper makeAdjust">
                      <div>
                        <input type="radio" class="form-radio" name="active" [(ngModel)]="sendPayload.payment_history_student_category_option" [value]="1"
                          id="others">
                        <label for="others" style="margin-left:10px;">Others</label>
                      </div>

                      <div style="position: relative;top: -25px;left:51px;">
                        <aside class="pull-left">
                          <rob-tooltip [textMessage]="'?'" [message]="helpMsg" [placement]="'left'" [customClass]="'left'">
                          </rob-tooltip>
                        </aside>
                      </div>
                    </div> -->
                </div>



              </div>
            </div>



            <!-- <div class="c-lg-2">
                <div class="c-lg-12">
                  <div class="c-lg-6" style="color:green; margin-top:5%;">
                    <h5 style="display: inline-block;">Active</h5>
                  </div>
                  <div class="c-lg-6">
                    <aside class="pull-left">
                      <rob-tooltip [textMessage]="'?'" [message]="helpMsg3" [placement]="'left'" [customClass]="'left'">
                      </rob-tooltip>
                    </aside>
                  </div>
                </div>
                <div class="c-lg-12">
                  <div class="c-lg-6" style="color:red ;margin-top:5%;">
                    <h5 style="display: inline-block;">Inactive</h5>
                  </div>
                  <div class="c-lg-6">
                    <aside class="pull-left">
                      <rob-tooltip [textMessage]="'?'" [message]="helpMsg4" [placement]="'left'" [customClass]="'left'">
                      </rob-tooltip>
                    </aside>
                  </div>
                </div>
                <div class="c-lg-12">
                  <div class="c-lg-6" style="color:brown ;margin-top:5%;">
                    <h5 style="display: inline-block;">Historical</h5>
                  </div>
                  <div class="c-lg-6">
                    <aside class="pull-left">
                      <rob-tooltip [textMessage]="'?'" [message]="helpMsg1" [placement]="'left'" [customClass]="'left'">
                      </rob-tooltip>
                    </aside>
                  </div>
                </div>
                <div class="c-lg-12">
                  <div class="c-lg-6" style="color:blue ;margin-top:5%;">
                    <h5 style="display: inline-block;">Archived</h5>
                  </div>
                  <div class="c-lg-6">
                    <aside class="pull-left">
                      <rob-tooltip [textMessage]="'?'" [message]="helpMsg2" [placement]="'left'" [customClass]="'left'">
                      </rob-tooltip>
                    </aside>
                  </div>
                </div>

              </div> -->

          </div>

          <div class="row" style="padding-top:16px;margin-top:16px;" *ngIf="searchByNameVisible">
            <div class="c-lg-3 field-wrapper">
              <label for=from>Student Name/Contact No/Reciept No</label>
              <input type="text" class="form-ctrl" id="from" [(ngModel)]="searchName">
            </div>

            <div class="c-lg-3 field-wrapper" style="margin-top:1%;">

              <input type="button" class="btn fullBlue" value="GO" (click)="getAllPaymentHistory()">


            </div>
          </div>

        </div>

        <div *ngIf="showPaymentBox && allPaymentRecords.length > 0">
          <div class="row">
            <div class="c-lg-12">
              <div class="c-lg-2" style="margin-top: 10px;">

                <a (click)="exportToExcel()" class="download" style="margin-top: 10px;">Download To Excel</a>
                <span class="fa fa-cloud-download">
                </span>
              </div>
              <div class="c-lg-8" style="margin-top: 10px;">
                <div class="c-lg-12">
                  <div class="c-lg-4  text-change" *ngIf="newData[0].hasOwnProperty('Cheque/PDC/DD No.')">
                    <span class="made-out"> Cheque/PDC/DD No</span>
                    <div class="font-element">₹{{newData[0]['Cheque/PDC/DD No.'].toLocaleString('en-IN')}}</div>
                  </div>
                  <div class="c-lg-4  text-change" *ngIf="newData[0].hasOwnProperty('Caution Deposit(Refundable)')">
                    <span class="made-out"> Caution Deposit(Refundable)</span>
                    <div class="font-element"> ₹{{newData[0]['Caution Deposit(Refundable)'].toLocaleString('en-IN')}}</div>
                  </div>
                  <div class="c-lg-4 text-change" *ngIf="newData[0].hasOwnProperty('Cash')">
                    <span class="made-out">Cash</span>
                    <div class="font-element"> ₹{{newData[0].Cash.toLocaleString('en-IN')}}</div>
                  </div>
                  <div class="c-lg-12" style="margin-top: 5px; margin-left: -15px;">
                    <div class="c-lg-4  text-change" *ngIf="newData[0].hasOwnProperty('Online Payment')">
                      <span class="made-out">Online Payments</span>
                      <div class="font-element"> ₹{{newData[0]['Online Payment'].toLocaleString('en-IN')}}</div>
                    </div>
                    <div class="c-lg-4  text-change" *ngIf="newData[0].hasOwnProperty('Credit/Debit Card')">
                      <span class="made-out"> Credit/Debit Card</span>
                      <div class="font-element"> ₹{{newData[0]['Credit/Debit Card'].toLocaleString('en-IN') }}</div>
                    </div>
                    <div class="c-lg-4  text-change">
                      <span class="made-out">Total Fees Collection</span>
                      <div class="font-element"> ₹{{allPaymentRecords[0].fees_amount.toLocaleString('en-IN')}}</div>

                    </div>
                  </div>
                </div>
              </div>

              <div class="c-lg-2">
                <div id="basic-search" style="float:right;">
                  <input #search type="text" class="search-field searchName" placeholder="Search" [(ngModel)]="searchText" name="searchData"
                    (keyup)="searchDatabase()" style="padding:7px 10px; width:200px; height:35px; margin-top: 10px; margin-bottom: 10px;">
                </div>
              </div>
            </div>
          </div>

        </div>


        <!-- Cash : {{collectionData.cash}} -->
        <!-- </li>
                    <li style="margin:4%">
                     
                    </li>
                  </ul>
                </div>
                <div class="c-lg-4">
                  <ul>
                    <li style="margin:4%">
                      -->
        <!-- </li>
                    <li style="margin:4%">
                      -->
        <!-- </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

        </div> -->


        <div class="table table-responsive">

          <rob-table [isMulti]='false' [hasMenu]="true" [dropType]="1" [menuOptions]="menuOptions" (multiOptionSelected)="optionSelected($event)"
            [records]="allPaymentRecords" [dataStatus]="dataStatus" [tableName]="'feereport'" [settings]="feeSettings1">
          </rob-table>
        </div>

      </div>
    </section>
  </aside>
</div>


<proctur-popup [sizeWidth]="'large'" *ngIf="addReportPopUp">

  <span class="closePopup pos-abs fbold show" (click)="closeReportPopup()" close-button>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="9310 2185 16 16">
      <g id="Group_1228" data-name="Group 1228" transform="translate(8298 1888)">
        <g id="Group_1213" data-name="Group 1213" transform="translate(34.189 -7.77)">
          <line id="Line_274" data-name="Line 274" class="cls-1" y2="19.798" transform="translate(992.81 305.77) rotate(45)" />
          <line id="Line_275" data-name="Line 275" class="cls-1" x1="19.798" transform="translate(978.81 305.77) rotate(45)" />
        </g>
        <rect id="Rectangle_686" data-name="Rectangle 686" style="stroke:none;" class="cls-2" width="16" height="16" transform="translate(1012 297)"
        />
      </g>
    </svg>
  </span>

  <div popup-header class="popup-header-content">
    <h2>Update Fee Receipt for {{personData.student_name}}
      <span style="font-size: 18px;">(#{{personData.student_disp_id}})</span>
    </h2>
  </div>

  <div popup-content class="main-student-table">
    <div class="table table-responsive">

      <table>
        <thead>
          <tr>
            <th>
              Installment No
            </th>
            <th>
              Fee Type
            </th>
            <th>
              Fee Amount(incl tax.)
            </th>
            <th>
              Amount Paid
            </th>
            <th>
              Balance Amount
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let d of perPersonData; let i = index;">
            <td>
              {{d.installment_no}}
            </td>
            <td>
              {{d.fee_type_name}}
            </td>
            <td>
              {{d.fees_amount}}
            </td>
            <td>
              <div class="field-wrapper">
                <input type="text" OnlyNumber="true" class="form-ctrl" [(ngModel)]="d.amount_paid" name='paidVal'>
              </div>
            </td>
            <td>
              {{d.balance_amount}}
            </td>
          </tr>
        </tbody>
      </table>

      <div class="row" class="field-made">

        <div class="c-lg-6 field-wrapper datePickerBox">
          <label>Payment Date</label>
          <input type="text" readonly="true" class="form-ctrl" bsDatepicker [(ngModel)]="updatedResult.paid_date">
        </div>

        <div class="c-lg-6 field-wrapper">
          <label>Payment Mode</label>
          <select class="form-ctrl" name="paymentMode" [(ngModel)]="updatedResult.paymentMode" (ngModelChange)="payModeUpdated($event)">

            <option value="Cash">Cash</option>
            <option value="Cheque/PDC/DD No.">Cheque/PDC/DD No.</option>
            <option value="Credit/Debit Card">Credit/Debit Card</option>
            <option value="Caution Deposit(Refundable)">Caution Deposit(Refundable)</option>
            <option value="Other">Other</option>
          </select>
        </div>
      </div>

      <div class="row">
        <div class="c-lg-6 field-wrapper">
          <label>Remarks</label>
          <input type="text" class="form-ctrl" [(ngModel)]="updatedResult.remarks">
        </div>
        <div class="c-lg-6 field-wrapper">
          <label>Reference No.</label>
          <input type="text" class="form-ctrl" [(ngModel)]="updatedResult.reference_no">
        </div>
      </div>

      <div class="row">
        <div class="c-lg-6 field-wrapper">
          <label>Receipt No.</label>
          <span class="field-red">*</span>
          <input type="text" OnlyNumber="true" class="form-ctrl" [(ngModel)]="personData.invoice_no">
        </div>
        <div class="c-lg-6 field-wrapper">
          <label>Reason for Update</label>
          <span class="field-red">*</span>
          <input type="text" class="form-ctrl" [(ngModel)]="updatedResult.fee_receipt_update_reason">
        </div>
        <input type="button" class="btn fullBlue" value="Close" (click)="closeReportPopup()" style="margin-right:10px;margin-left:15px; margin-top:1%"
          *ngIf="!isChequePayment">
        <input type="button" class="btn fullBlue" value="Update" style="margin-right:10px;margin-left:5px; margin-top:1%" (click)="updationOfPerPersonData()"
          *ngIf="!isChequePayment">
      </div>

      <div *ngIf="isChequePayment" style="margin-top: 10px;" class="field-made">
        <div>
          <h2 style="margin-left:8px;">Cheque Details</h2>
          <div class="row">
            <div class="c-lg-6 field-wrapper">
              <label>Bank Name</label>
              <span class="field-red">*</span>
              <input type="text" [(ngModel)]="chequeDetailsJson.bank_name" name="bank" class="form-ctrl" [ngClass]="{'has-value': chequeDetailsJson.bank_name != ''}">
            </div>
            <div class="c-lg-6 field-wrapper">
              <label>Cheque No.</label>
              <span class="field-red">*</span>
              <input type="text" class="form-ctrl" name="cheque_no" [(ngModel)]="chequeDetailsJson.cheque_no" [ngClass]="{'has-value': chequeDetailsJson.cheque_no != ''}">
            </div>
          </div>
          <div class="row">
            <div class="c-lg-6 field-wrapper datePickerBox">
              <label>Cheque Date</label>
              <span class="field-red">*</span>
              <input type="text" class="form-ctrl" name="cheque_date" bsDatepicker [(ngModel)]="chequeDetailsJson.cheque_date" [ngClass]="{'has-value': chequeDetailsJson.cheque_date != ''}">
            </div>
            <div class="c-lg-6 field-wrapper">
              <label>Cheque Amount</label>
              <span class="field-red">*</span>
              <input type="text" class="form-ctrl" [value]="updationArray.total_amt_paid | currency:'₹' :0" disabled>
            </div>
          </div>

          <div class="row">

            <div class="c-lg-6 field-wrapper">
              <label>Cheque Status</label>
              <span class="field-red">*</span>
              <select class="form-ctrl" [(ngModel)]="chequeDetailsJson.cheque_status_id">
                <option value="1" selected>
                </option>
                <option value="2">
                  Dishonoured
                </option>
                <option value="3">
                  Cleared
                </option>
              </select>
            </div>
          </div>

          <div style="margin-top: 1%; margin-left:5px;">
            <input type="button" class="btn fullBlue" value="Save" (click)="updationOfPerPersonData()">
            <input type="button" class="btn fullBlue" value="Close" (click)="closeReportPopup()">
          </div>

        </div>
      </div>

    </div>
  </div>


  <div popup-footer>

  </div>

</proctur-popup>