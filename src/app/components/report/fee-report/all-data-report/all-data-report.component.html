<loaders-css [loader]="'ball-scale-ripple-multiple'" class="app-loader-wrapper" [loaderClass]="'blueRipple'" *ngIf="isRippleLoad">
</loaders-css>
<div class="report-wrapper clearFix">
    <aside class="middle-full">
        <section class="middle-main clearFix">
            <div class="middle-top mb0 clearFix header" style="width: 99%;
            margin-left: 10px;
            padding-bottom: 20px;">
                <div class="row">
                    <h2 style="padding: 16px 0px 3px 32px;" class="pull-left">
                        <a routerLink="/view/reports">
                            Report

                        </a>
                        <i style="font-family: 'FontAwesome';" class="fas fa-angle-right"></i>
                        <a routerLink="/view/reports/fee">
                            Fee Report

                        </a>
                        <i style="font-family: 'FontAwesome';" class="fas fa-angle-right"></i> All dues Report
                    </h2>
                    <aside class="pull-left" style="position:relative; top:10px;">
                        <rob-tooltip [textMessage]="'?'" [message]="helpMsg" [placement]="'left'" [customClass]="'left'">
                        </rob-tooltip>
                    </aside>
                </div>

                <div class="row fee-filter" [ngClass]="{'long': showPopupKeys.isFilterReversed}" style="margin-left: 0px;">
                    <div id="secondary">

                        <div class="c-lg-3">
                            <div class="field-wrapper">
                                <label for="sd">Select Dues</label>
                                <select [(ngModel)]="due_type" (ngModelChange)="dateRangeChanges($event)" name="sd" id="sd" class="form-ctrl">
                                    <option value="-1"></option>
                                    <option value="all_dues">All Dues</option>
                                    <option value="seven_days_dues" selected>Last 7 days dues</option>
                                    <option value="thirty_days_dues">Last 30 days dues</option>
                                    <option value="ninty_days_dues">Last 90 days dues</option>
                                    <option value="next_month_dues">Next Month Dues</option>
                                    <option value="this_month_dues">This Month Dues</option>
                                    <option value="current_dues">Current Dues</option>
                                    <option value="custom">Custom</option>
                                </select>
                            </div>
                        </div>

                        <div class="c-lg-3 radio-group hide">
                            <div class="c-lg-6 field-radio-wrapper">
                                <input class="form-radio" type="radio" name="dues" value="0" id='r1' [(ngModel)]="courseFetchForm.type" checked>
                                <label for="r1">All Students</label>
                            </div>

                            <div class="c-lg-6 field-radio-wrapper">
                                <input class="form-radio" type="radio" name="dues" value="1" [(ngModel)]="courseFetchForm.type" id='r2'>
                                <label for="r2">Previous Dues</label>
                            </div>
                        </div>

                        <div class="c-lg-3" *ngIf="showPopupKeys.isCustomDate">
                            <div class="field-wrapper datePickerBox">
                                <label for="ic">From Date</label>
                                <input [(ngModel)]="courseFetchForm.from_date" (ngModelChange)="validateFutureDate('from')" type="text" value="" readonly="true"
                                    class="form-ctrl bsDatepicker" bsDatepicker/>
                            </div>
                            <span style="cursor: pointer; color: #ff0000;" (click)="courseFetchForm.from_date = ''">clear</span>
                        </div>

                        <div class="c-lg-3" *ngIf="showPopupKeys.isCustomDate">
                            <div class="field-wrapper datePickerBox">
                                <label for="ic">To Date</label>
                                <input [(ngModel)]="courseFetchForm.to_date" type="text" value="" readonly="true" class="form-ctrl bsDatepicker" bsDatepicker/>
                            </div>
                            <span style="cursor: pointer;color: #ff0000;" (click)="courseFetchForm.to_date = ''">clear</span>
                        </div>
                        <div class="c-lg-3 field-wrapper sky-form">
                            <label>Academic Year</label>
                            <select name="academic_year_id" id="academic_year_id" style="height:auto" [(ngModel)]="courseFetchForm.academic_year_id"
                                class="form-ctrl sky-inner">
                                <option value="-1">
                                </option>
                                <option *ngFor="let i of getAllAcademic" [value]="i.inst_acad_year_id">
                                    {{i.inst_acad_year}}
                                </option>
                            </select>
                        </div>

                        <div class="c-lg-2 filter-btn">
                            <button class="btn fullBlue" (click)="fetchFeeDetails()">Go</button>
                        </div>

                        <div class="c-lg-1 filter-btn hide">
                            <div class="filter-right pull-right">
                                <a href="javascript:void(0);" id="adFilterOpen" (click)="openAdFilter()" class="openAdFilter">Switch Filter</a>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <section style="margin-top: 10px;">
                <div class="row">
                    <div class="c-lg-3" style="margin-top: 1%;">
                        <p-splitButton label="download" [model]="bulkAddItems" icon="pi pi-file"></p-splitButton>
                        <a (click)="openPreferences()" title="Select Table Preferences"> select preference &nbsp;
                            <i class="fa fa-question-circle" aria-hidden="true" style="color:#0060A3"></i>
                        </a>
                    </div>

                    <div class="c-lg-7">
                        <ul *ngIf="feeDataSource1[0] != null || feeDataSource1[0] != undefined" style="display: inline-block; width:50%; text-align: right;">
                            <li style="display: inline-block; margin-left: 11px;">
                                <span class="made-out"> Total fees Collection</span>
                                <div class="made-in"> ₹{{feeDataSource1[0].total_fees_collected.toLocaleString('en-IN')}}</div>
                            </li>
                            <li style="display: inline-block; margin-left: 5vw; ">
                                <span class="made-out">Total dues</span>
                                <div class="made-in">₹{{feeDataSource1[0].total_dues_pending.toLocaleString('en-IN')}}</div>
                            </li>
                        </ul>
                    </div>

                    <div class="c-lg-2">
                        <div id="basic-search">
                            <form autocomplete="off" #form="ngForm">
                                <input type="text" name="searchValue" [(ngModel)]="userInput" placeholder="Search" class="form-ctrl" id="searchBar" style="padding:7px 10px; width:200px; height:35px; float:right; margin-bottom: 10px;">
                            </form>
                        </div>
                    </div>
                </div>

            </section>

            <div class="table-content" *ngIf="showPopupKeys.isFilterReversed">
                <!-- <div style="margin-left: 10px;display: inline-block; margin-top: 10px;">
                    <button (click)="exportToExcel()" class="download btn fullBlue">Excel</button>
                    <button (click)="exportToPdf()" class="btn fullBlue">Pdf</button>
                    
                </div> -->


                <data-display-table *ngIf="displayKeys.length" #child [displayKeys]="tableSetting" [displayData]="feeDataSource1" (editView)='optionSelected($event)'>
                </data-display-table>
                <!-- <rob-table (rowIdArr)="selectedRecords($event)" [menuOptions]="menuOptions" (multiOptionSelected)="optionSelected($event)"
                    [isMulti]='true' [hasMenu]="true" [records]="feeDataSource1" [dataStatus]="dataStatus" [tableName]="'feereport'"
                    [settings]="feeSettings1">
                </rob-table> -->

            </div>
            <div class="table-content" *ngIf="!showPopupKeys.isFilterReversed">
                <rob-table [menuOptions]="menuOptions" [isMulti]='true' [hasMenu]="false" [records]="feeDataSource2" [tableName]="'feereport'"
                    [dataStatus]="dataStatus" [settings]="feeSettings2">
                </rob-table>
            </div>
        </section>
    </aside>

    <fee-receipt [feeData]="selectedFeeRecord" (closeButton)="closePopup($event)" *ngIf="showPopupKeys.isFeeReceipt"></fee-receipt>

    <next-due-detail [feeData]="selectedFeeRecord" (closeButton)="closePopup($event)" *ngIf="showPopupKeys.isNextDueDetail"></next-due-detail>

    <payment-history [feeData]="selectedFeeRecord" (closeButton)="closePopup($event)" *ngIf="showPopupKeys.isFeepaymentHistory"></payment-history>

    <view-detail-report [feeData]="selectedFeeRecord" (closeButton)="closePopup($event)" *ngIf="showPopupKeys.isViewDetailReport"></view-detail-report>

    <preference-popup [settings]="tableSetting" [keys]="feeSettings1" (closeButton)="closePopup($event)" *ngIf="showPopupKeys.showPreference"></preference-popup>
</div>