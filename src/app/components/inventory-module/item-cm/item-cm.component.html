<div class="page-content">
    <div class="head_padding">
       <div class="w98">
         <div class="display">
         <div class="page_heading pageheadingspace">
           <p>Items</p>
         </div>
         <div>

          <button class="blue_button" data-toggle="modal" data-target="#addModal" *ngIf="isaddcat" (click)="cancel(false)" >Add Category</button>
           <button class="blue_button" data-toggle="modal" data-target="#itemModal"  *ngIf="is_add_item"  (click)="cancel(false)"  >Add Item</button>
          <!-- Two Diffrent Button On Tab Change -->
      </div>
         </div>
         <!-- Nav tabs -->
         <ul class="nav">
          <li class="nav-item" >
            <a class="nav-link" (click)="toggle('onev',false)"  data-toggle="tab" href="#onev"  [ngClass]="(activeSession == 'onev') ? 'active' : ''">Item Category</a>
          </li>
          <li class="nav-item">
            <a class="nav-link"  data-toggle="tab" (click)="toggle('twov',true)" href="#twov" [ngClass]="(activeSession == 'twov') ? 'active' : ''" >Item Management</a>
          </li>
         </ul>
       </div>
     </div>
 

  <!--pagination for category-->
  <div class="tab-content">
    <div id="onev" class="tab-pane active">
   <!--  one -->
        <div class="w98">
            <div class="pt15 display">
            <div>
                <input type="text" name="search" [(ngModel)]="searchText" (keyup)="searchDatabase()"
                class="input wid240 mr10 magnifying-glass" name="" placeholder="Search">
            </div>
            <div class="right">
                <!-- <a href="" class="mr10"><img src="../../../assets/img1/copy2.svg" title="Copy"></a>
                <a href="" class="mr10"><img src="../../../assets/img1/csv.svg" title="CSV"></a> -->
                <a (click)="downloadPdf()" class="mr10"><img src="../../../assets/img1/pdf.svg" title="PDF Preview"></a> 
                <a (click)="exportToExcel()" class="mr10"><img src="../../../assets/img1/excel.svg" title="Excel Download"></a>
           </div>
            </div>
             <!--table for item-->
            <app-basic-table [headers]="headerSetting" [tableSetting]="tableSetting" [displayData]="pagedclassRoomData"
            [rowColumnSetting]="rowColumns" (editView)='editRow($event)' (deleteView)='deleteRow($event)'
            (viewView)="viewRow($event)">
        </app-basic-table>
       </div>
        <!--pagination for category-->
        <pagination (goPage)="fetchTableDataByPage($event)" (goNext)="fetchNext()" (goPrev)="fetchPrevious()"
        [pagesToShow]="10" [page]="pageIndex" [perPage]="displayBatchSize" [count]="totalRow" [sizeArr]="sizeArr"
        (sizeChange)="updateTableBatchSize($event)">
      </pagination>
    
    </div>
     <!--Data for item-->
    <div id="twov" class="tab-pane">
      <!-- two -->
      <div class="w98">
        <div class="pt15 display">
          <div>
            <input type="text" name="search" [(ngModel)]="searchTextforItem" (keyup)="searchDatabaseforItem()"
            class="input wid240 mr10 magnifying-glass" name="" placeholder="Search">
      </div>
            <div class="right">
                <!-- <a href="" class="mr10"><img src="../../../assets/img1/copy2.svg" title="Copy"></a>
                <a href="" class="mr10"><img src="../../../assets/img1/csv.svg" title="CSV"></a>-->
                <a (click)="downloadPdffoItem()" class="mr10"><img src="../../../assets/img1/pdf.svg" title="PDF Preview"></a> 
                <a (click)="exportToExcelItem()" class="mr10"><img src="../../../assets/img1/excel.svg" title="Excel Download"></a>
            </div>
        </div>
         <!--table for item-->
        <div class="item_man">
            <div class="table_heading">
              <div>Item<span class="space33"><img src="../../../assets/img1/down1a.svg"></span> </div>
              <div>Category<span class="space33"><img src="../../../assets/img1/down1a.svg"></span> </div>
              <div>Total Units<span class="space33"><img src="../../../assets/img1/down1a.svg"></span> </div>
              <div>Available Units<span class="space33"><img src="../../../assets/img1/down1a.svg"></span> </div>
              <div>
                Buying Price<br>(Unit Price)
              </div>
              <div>Sale Price<br>(Unit Price)</div>
              <div>Taxes (%)</div>
              <div>Low Stock<br>indicator (Units)</div>
              <div>Actions</div>
            </div>
            <div class="table_body" *ngFor="let data of pagedItemData">
              <p ></p>
              <div [ngClass]="{'lowstock':data.available_units <= data.out_of_stock_indicator_units }">
               {{data.item_name}}
              </div>
             <div>
              {{data.category_name}}
             </div>
             <div>  {{data.alloted_units}}</div>
             <div>{{data.available_units}}</div>
             <div>{{data.unit_cost}}</div>
             <div>{{data.sale_price}}</div>
             <div>{{data.tax_percent}}</div>
             <div>{{data.out_of_stock_indicator_units}}</div>
              <div>
                
                <div class="dropdown1">
                    <img src="../../../assets/img1/menu.svg" class="dot3">
                  <div class="dropdown-content1">
                    <a href="#" data-toggle="modal" data-target="#itemModal" (click)="editItem(data)">Edit</a>
                    <a href="#" data-toggle="modal" data-target="#deleteitemModal" (click)="deleteItem(data.item_id)">Delete</a>
                    <a href="#"  data-toggle="modal" data-target="#subbranchModal">Allocate to Sub-branch</a>
                    <a href="" data-toggle="modal" data-target="#historyModal" >Allocation History</a>
                    <a href="" data-toggle="modal" data-target="#manageunitModal">Manage Unit</a>
                  </div>
                </div>
              </div>
            </div>
        </div>
      </div>
      <!--pagination for item-->
    <pagination (goPage)="fetchTableDataByPageforItem($event)" (goNext)="fetchNextItem()" (goPrev)="fetchPreviousItem()"
        [pagesToShow]="10" [page]="pageIndexforItem" [perPage]="displayBatchSize" [count]="totalItemRow" [sizeArr]="sizeArr"
        (sizeChange)="updateTableBatchSize($event)">
      </pagination> </div>
  </div>
     
          <!-- use image only when page is empty,table body class element will not be present -->

</div> 
 <!--model for item-->
  <div class="modal" id="addModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header" >
          <h4 class="modal-title" *ngIf="!isedit"> Add Category</h4>
          <h4 class="modal-title" *ngIf="isedit"> Update Category</h4>
          <button type="button" class="close" data-dismiss="modal"  (click)="cancel(false)" >&times;</button>
        </div>
        <div class="modal-body">
     <form  #catForm="ngForm" autocomplete="off">
          <div class="pt10" [class.has-error]="category_name.invalid && category_name.touched">
            <input type="text" class="input wid100" id ="category_name"
            name="category_name" placeholder="Category Name*"
            [(ngModel)]="category_model.category_name"
            #category_name="ngModel" required >
          </div>
          <p class="errormsg"><span  style="height:10px;" class="help-block" *ngIf="!category_name.valid && category_name.touched">
            Category  name is mandatory
         </span></p>
          <div class="pt10">
            <textarea class="input wid100" name="desc" id="desc"
            [(ngModel)]="category_model.desc" placeholder="Description" ></textarea>
          </div>
        
          <div class="pt10 display">
            <div></div>
            <div class="align"> 
              <button type="button" class="right blue_button cancel"
              data-dismiss="modal" (click)="cancel(false)">Cancel</button>
              <button class="right blue_button" (click)="saveCategoryDetails(category_model)" *ngIf="!isedit">Save</button>
              <button class="right blue_button" (click)="updateCategoryDetails(category_model)" *ngIf="isedit">Update</button></div>
           </div>
           </form>
        </div>        
      </div>
    </div>
  </div> 
   <!--delete model for category-->
  <div class="modal" id="deleteModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="center">
            <span><img src="../../../assets/img1/alert.svg"></span><span class="alert">Alert</span>
          </div>
          <div >
            <p class="alert_text"> "X" items available under this category 
          which are not allocated, do you want
           to proceed ?</p>
          </div>
          <div class="pt101 display">
            <div>
              <button class="white_button right" data-dismiss="modal">Cancel</button>
            </div>
            <div>
              <button class="blue_button right" >Delete</button>
            </div>
          </div>
        </div>        
      </div>
    </div>
  </div>
  <div class="modal" id="delete1Modal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="center">
            <span><img src="../../../assets/img1/alert.svg"></span><span class="alert">Alert</span>
          </div>
          <div >
            <p class="alert_text">You can't delete this category since the items under this category are allocated</p>
          </div>
        </div>        
      </div>
    </div>
  </div>
  <div class="modal" id="deleteitemModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="center">
            <span><img src="../../../assets/img1/alert.svg"></span><span class="alert">Alert</span>
          </div>
          <!-- <div ><p>Do you want
           to proceed ?</p>
          </div> -->
          <div class="pt101 display">
            <div>
              <button class="white_button right">Cancel</button>
            </div>
            <div>
              <button class="blue_button right">Delete</button>
            </div>
          </div>
        </div>        
      </div>
    </div>
  </div>
  <div class="modal" id="manageunitModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" >Manage Unit</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="pt10">
            <input type="text" class="input wid100" name="" placeholder="Available Units*">
          </div>
            <div class="pt10">
                  <select class="select wid100" name="">
                    <option>
                      Manage Unit*
                  </select>
            </div>
          <div class="pt10">
            <input type="text" class="input wid100" name="" placeholder="Total Unit Units*">
          </div>
        
          <div class="pt10 display">
            <div></div>
            <div> <button class="right blue_button">Save</button></div>
           </div>
        </div>        
      </div>
    </div>
  </div> 
   <!--add edit model for item-->
  <div class="modal" id="itemModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" *ngIf="!isedit" >Add Item</h4>
          <h4 class="modal-title" *ngIf="isedit">Update Item</h4>
          <button type="button" class="close" data-dismiss="modal"
          (click)="cancel(false)">&times;</button>
        </div>
        <div class="modal-body">
          <form #itemForm ="ngForm" autocomplete="off">
          <div class="flex">
            <div class="sec1">
              <div class="pt10"  [class.has-error]="item_name.invalid && item_name.touched">
                  <input type="text" class="input wid100" id="item_name" name="item_name" placeholder="Item*"  [(ngModel)]="item.item_name"
                  #item_name="ngModel" required>
              </div>
              <p class="errormsg"><span  style="height:10px;" class="help-block" *ngIf="!item_name.valid && item_name.touched">
                Item  name is mandatory
             </span></p>
                <div class="pt10">
                  <select class="select wid100" name="standard_id" id="standard_id"
                  [(ngModel)]="item.standard_id" (ngModelChange)="onMasterCourseSelection($event)">
                    <option value="">
                     Standard
                    </option>
                    <option *ngFor="let opt of masterCourseList" [value]="opt.standard_id">
                      {{opt.standard_name}}
                    </option>
                  </select>
                </div>
               <p class="errormsg"><span  style="height:10px;" class="help-block">
               </span></p>
              <div class="pt10" [class.has-error]="alloted_units.invalid && alloted_units.touched" >
                  <input type="text" class="input wid100" id="alloted_units" 
                  name="alloted_units" placeholder="Total Units*"  
                  #alloted_units="ngModel" 
                  [(ngModel)]="item.alloted_units" required
                  onkeypress=" return (event.charCode >= 48 && event.charCode <= 57)">
              </div>
              <p class="errormsg"><span  style="height:10px;" class="help-block" *ngIf="!alloted_units.valid && alloted_units.touched">
                Total units are mandatory
             </span></p>
              <div class="pt10" [class.has-error]="sale_price.invalid && sale_price.touched" >
                <input type="text" class="input wid100" id="sale_price" 
                name="sale_price" placeholder="Sale Price (Unit Price)*"  
                #sale_price="ngModel" 
                [(ngModel)]="item.sale_price"  
                onkeypress=" return (event.charCode >= 48 && event.charCode <= 57)" 
                required>
            </div>
            <p class="errormsg"><span  style="height:10px;" class="help-block" *ngIf="!sale_price.valid && sale_price.touched">
              Sale or unit price is mandatory
           </span></p>
               <div class="pt10" [class.has-error]="tax_percent.invalid && tax_percent.touched" >
                  <input type="text" class="input wid100" id="tax_percent" 
                  name="tax_percent" placeholder="Tax(%)"  
                  #tax_percent="ngModel" 
                  [(ngModel)]="item.tax_percent" onkeypress=" return (event.charCode >= 48 && event.charCode <= 57)" required>
              </div>
              <p class="errormsg"><span  style="height:10px;" class="help-block">
             </span></p>
            </div>
            <div class="sec2">
              <div class="pt10"  [class.has-error]="abc.invalid && abc.touched">
                <select class="select wid100" name="category_id" id="category_id"
                [(ngModel)]="item.category_id"  required #abc="ngModel">
                  <option value="">
                   Category*
                  </option>
                  <option value="{{data.category_id}}" *ngFor="let data of categoryAllData">
                    {{data.category_name}}</option>
                </select>
              </div>
              <p class="errormsg"><!-- <span  style="height:10px;"  *ngIf="abc.invalid && abc.touched"class="help-block">
                Category is mandatory
               </span> --></p>
             <div class="pt10">
              <select class="select wid100" name="subject_id" id="subject_id"
              [(ngModel)]="item.subject_id" >
                <option value="">
                Subject
                </option>
                <option *ngFor="let opt of CourseList" [value]="opt.subject_id">
                  {{opt.subject_name}}
                </option>
              </select>
            </div>
            <p class="errormsg"><span  style="height:10px;" class="help-block">
              </span></p>
                <div class="pt10" [class.has-error]="unit_cost.invalid && unit_cost.touched" >
                  <input type="text" class="input wid100" id="unit_cost" 
                  name="unit_cost" placeholder="Buying Price (Unit Price)*"  
                  #unit_cost="ngModel" 
                  [(ngModel)]="item.unit_cost"
                  onkeypress=" return (event.charCode >= 48 && event.charCode <= 57)" required>
              </div>
              <p class="errormsg"><span  style="height:10px;" class="help-block" *ngIf="!unit_cost.valid && unit_cost.touched">
                Buying or unit price is mandatory
             </span></p>
              <div class="pt10" [class.has-error]="out_of_stock_indicator_units.invalid && out_of_stock_indicator_units.touched" >
                <input type="text" class="input wid100" id="out_of_stock_indicator_units" 
                name="out_of_stock_indicator_units" placeholder="Low Stock Indicator*"  
                #out_of_stock_indicator_units="ngModel" 
                onkeypress=" return (event.charCode >= 48 && event.charCode <= 57)"
                [(ngModel)]="item.out_of_stock_indicator_units" required>
            </div>
            <p class="errormsg"><span  style="height:10px;" class="help-block" *ngIf="!out_of_stock_indicator_units.valid && out_of_stock_indicator_units.touched">
              Low stock indicator  is mandatory
           </span></p>
            </div>
          </div>
             <div class="pt10">
                   <textarea class="input wid100" name="desc" id="desc" placeholder="Description" [(ngModel)]="item.desc"></textarea>
              </div>
          <!-- </div> -->
          <p class="errormsg"><span  style="height:10px;" class="help-block">
         </span></p>
         
          <div class="pt10 display w98">
            <div></div>
            <div class="align"> 
              <button type="button" class="right blue_button cancel"
              data-dismiss="modal" >Cancel</button>
              <button class="right blue_button" (click)="saveItemDetails(item)" *ngIf="!isedit">Save</button>
              <button class="right blue_button" (click)="updateItemDetails(item.item_id)" *ngIf="isedit">Update</button></div>
           </div>
          </form>
        </div>        
      </div>
    </div>
  </div>
  <div class="modal" id="subbranchModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" >Allocate to Sub-branch</h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
          <div class="flex">
            <div class="sec1">
              <div class="pt10">
                  <input type="text" class="input wid100" name="" placeholder="Item*">
              </div>
             
              <div class="pt10">
                  <select class="select wid100" name="">
                    <option>
                      Sub-Branch*
                    </option>
                  </select>
              </div>
               <div class="pt10">
                  <input type="text" class="input wid100" name="" placeholder="Allocate Unit*">
              </div>
               <div class="pt10">
                  <input type="text" class="input wid100" name="" placeholder="Challan No.">
              </div>
               <div class="pt10">
                  <input type="text" class="input wid100" name="" placeholder="Challan Amount">
              </div>
            </div>
            <div class="sec2">
              <div class="pt10">
                  <input type="text" class="input wid100" name="" placeholder="Available Units">
              </div>
              <div class="pt10">
                  <select class="select wid100" name="">
                    <option>
                      Sub-Branch Item*
                    </option>
                  </select>
              </div>
              <div class="pt10">
                  <input type="text" class="input wid100" name="" placeholder="Tranport">
              </div>
              <div class="pt10">
                  <input type="date" class="input wid100" name="" placeholder="Challan Date" >
              </div>
            </div>
          </div>
          <div class="pt10 display">
           <div></div>
           <div> <button class="right blue_button">Save</button></div>
          </div>
        </div>        
      </div>
    </div>
  </div>    
  <div class="modal" id="historyModal">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h4 class="modal-title" >Allocation History </h4>
          <button type="button" class="close" data-dismiss="modal">&times;</button>
        </div>
        <div class="modal-body">
           <div class="allo_history">
            <div class="table_heading">
              <div>
               #
              </div>
              <div>Date</div>
              <div>
                From/To
              </div>
              <div>Contact No.</div>
              <div>Quantity</div>
              <div>In/Out</div>
            </div>
            <div class="table_body">
              <div>
                1
              </div>
              <div>
               23-03-2021
              </div>
              <div>
                -
              </div>
             <div>
              0987654321
             </div>
             <div>10</div>
              <div>
                <span class="in1">In</span>
              </div>
            </div>
            <div class="table_body">
              <div>
                1
              </div>
              <div>
               23-03-2021
              </div>
              <div>
                -
              </div>
             <div>
              0987654321
             </div>
             <div>10</div>
              <div>
                <span class="out">Out</span>
              </div>
            </div>
        </div>
        </div>        
      </div>
    </div>
  </div>